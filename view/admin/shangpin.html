<!--添加商品界面-->
{include file="public/header" /}
<link rel="stylesheet" type="text/css" href="https://www.layuicdn.com/layui/css/layui.css" />
<div class="content">
<div class="page-inner">
<div class="row">
<div class="col-md-12">
<div class="card">
    
	<div class="card-header">
		<h4 class="card-title">添加商品<sub></sub></h4>
	</div>
	<div class="form-group">
	    <form>
    	<label for="successInput">商品标题</label>
    	<input type="text" id="title" value="" class="form-control">		        
	    <br>
	        
		<label for="defaultSelect">选择分组</label>
		<select class="form-control form-control" id="gid">
		    {volist name="data.shangpin_gid" id="vo" empty="您还没有创建商品分类"}
			<option value="{$vo.gid}">{$vo.name}</option>
			{/volist}
		</select>
		<a href="shangpin_gid" style="color:#fff;">添加分组</a>
		<br>
		<br>
		<label for="comment">商品描述</label>
		<textarea class="form-control" id="content" rows="5"></textarea>
		<br>
        <div class="layui-upload">
          <button type="button" class="layui-btn" id="shangpin_product_img">上传封面图</button>
          <div class="layui-upload-list">
            <img class="layui-upload-img" id="demo1">
            <p id="demoText"></p>
          </div>
        </div>   
    	<input type="hidden" id="img">
        </form>
        <br>
        <button type="submit" onclick="add_shangpin()" class="btn btn-success">保存商品</button>
	</div>

    <div style="height:30px;"></div>
    	<div class="card-header">
			<div class="card-title">商品列表</div>
		</div>
		<div class="card-body">

			
			<table class="table mt-3">
				<thead>
					<tr>
						<th scope="col">id</th>
						<th scope="col">分组名称</th>
						<th scope="col">添加时间</th>
						<th scope="col">添加数据</th>
						<th scope="col">操作</th>
					</tr>
				</thead>
				<tbody>
				    {volist name="data.shangpin" id="shangpin" empty="暂无分组信息"}
					<tr>
						<td>{$shangpin.id}</td>
						<td>{$shangpin.title}</td>
						<td>{:date('Y-m-d H:i:s',$shangpin.add_time)}</td>
						<td><button class="btn btn-danger btn-xs" onclick="add_shipin('{$shangpin.id}')">上传视频</button></td>
						<td><button class="btn btn-danger btn-xs" onclick="delete_shangpin('{$shangpin.id}')">删除</button></td>
					</tr>
                    {/volist}
				</tbody>
			</table>
		</div>
	
</div>
</div>
</div>
</div>
</div>

{include file="public/footer" /}

    <script>
            
        
    
    //保存商品
    function add_shangpin(){
        var title= $('#title').val();
        var gid = $('#gid').val();
        var content = $('#content').val();
        var img = $('#img').val();
        
        if(!title){
            layer.msg('请填写商品标题');
            return;
        }
        if(!content){
            layer.msg('请填写商品描述');
            return;
        }
        if(!img){
            layer.msg('img为空');
            return;
        }  
        
        $.post('add_shangpin',{'title':title,'gid':gid,'content':content,'img':img},function(res){
            if(res.code>0){
                layer.msg(res.msg);
            }else{
                layer.msg(res.msg);
                setTimeout(function(){location.reload()},800);
            }
        },'json');
        
    }
    
    
        //删除
     function delete_shangpin(id){
        $.post('delete_shangpin',{'id':id},function(res){
              if(res.code>0){
                $.notify({
                	icon: 'flaticon-alarm-1',
                	title: '操作提示',
                	message: res.msg,
                },{
                	type: 'info',
                	placement: {
                		from: "bottom",
                		align: "right"
                	},
                	time: 1000,
                });
            }else{

               $.notify({
                	icon: 'flaticon-alarm-1',
                	title: '操作提示',
                	message: res.msg,
                },{
                	type: 'info',
                	placement: {
                		from: "bottom",
                		align: "right"
                	},
                	time: 1000,
                });
                setTimeout(function(){location.reload()},800);
            }
        },'json')
    }

	layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element','form'], function() {
      form = layui.form;
	  layer = layui.layer;
      var laydate = layui.laydate //日期
      ,laypage = layui.laypage //分页
      ,layer = layui.layer //弹层
      ,table = layui.table //表格
      ,carousel = layui.carousel //轮播
      ,upload = layui.upload //上传
      ,element = layui.element; //元素操作 等等...
          //普通图片上传
                //上传用户头像
      var uploadInst = upload.render({
        elem: '#shangpin_product_img' //绑定元素
        ,url: 'update_shangpinimg' //上传接口
        ,before: function(obj){
              //预读本地文件示例，不支持ie8
              obj.preview(function(index, file, result){
                $('#demo1').attr('src', result); //图片链接（base64）
              });
            }
        ,done: function(res){
          //上传完毕回调
          console.log(res.msg);
          if(res.code>0){
              layer.msg(res.msg)
          }else{
              layer.msg('上传成功');
              $('#img').val(res.msg);
          }
        }
        ,accept: 'png,jpg,gif,jpeg'
        ,size: 10240
        ,error: function(){
          //请求异常回调
        }
      });
          
    });
    </script>